<?php

/**
 * 判断当前GPS坐标是否在中国
 * 基于Google坐标系，未处理投影问题，如需处理请加上转换逻辑
 * IDE 自动生成了部分PHP7特有的内容，如果不需要请自行删除
 * Class CheckChinaGPSLocation
 * @author loveyu
 */
class CheckChinaGPSLocation
{
	/**
	 * @var array 中国大陆包含香港澳门的GPS边界
	 */
	private static $main_land_map = [
		[27.32083, 88.91693],
		[27.54243, 88.76464],
		[28.00805, 88.83575],
		[28.1168, 88.62435],
		[27.86605, 88.14279],
		[27.82305, 87.19275],
		[28.11166, 86.69527],
		[27.90888, 86.45137],
		[28.15805, 86.19769],
		[27.88625, 86.0054],
		[28.27916, 85.72137],
		[28.30666, 85.11095],
		[28.59104, 85.19518],
		[28.54444, 84.84665],
		[28.73402, 84.48623],
		[29.26097, 84.11651],
		[29.18902, 83.5479],
		[29.63166, 83.19109],
		[30.06923, 82.17525],
		[30.33444, 82.11123],
		[30.385, 81.42623],
		[30.01194, 81.23221],
		[30.20435, 81.02536],
		[30.57552, 80.207],
		[30.73374, 80.25423],
		[30.96583, 79.86304],
		[30.95708, 79.55429],
		[31.43729, 79.08082],
		[31.30895, 78.76825],
		[31.96847, 78.77075],
		[32.24304, 78.47594],
		[32.5561, 78.40595],
		[32.63902, 78.74623],
		[32.35083, 78.9711],
		[32.75666, 79.52874],
		[33.09944, 79.37511],
		[33.42863, 78.93623],
		[33.52041, 78.81387],
		[34.06833, 78.73581],
		[34.35001, 78.98535],
		[34.6118, 78.33707],
		[35.28069, 78.02305],
		[35.49902, 78.0718],
		[35.50133, 77.82393],
		[35.6125, 76.89526],
		[35.90665, 76.55304],
		[35.81458, 76.18061],
		[36.07082, 75.92887],
		[36.23751, 76.04166],
		[36.66343, 75.85984],
		[36.73169, 75.45179],
		[36.91156, 75.39902],
		[36.99719, 75.14787],
		[37.02782, 74.56543],
		[37.17, 74.39089],
		[37.23733, 74.91574],
		[37.40659, 75.18748],
		[37.65243, 74.9036],
		[38.47256, 74.85442],
		[38.67438, 74.35471],
		[38.61271, 73.81401],
		[38.88653, 73.70818],
		[38.97256, 73.85235],
		[39.23569, 73.62005],
		[39.45483, 73.65569],
		[39.59965, 73.95471],
		[39.76896, 73.8429],
		[40.04202, 73.99096],
		[40.32792, 74.88089],
		[40.51723, 74.8588],
		[40.45042, 75.23394],
		[40.64452, 75.58284],
		[40.298, 75.70374],
		[40.35324, 76.3344],
		[41.01258, 76.87067],
		[41.04079, 78.08083],
		[41.39286, 78.39554],
		[42.03954, 80.24513],
		[42.19622, 80.23402],
		[42.63245, 80.15804],
		[42.81565, 80.25796],
		[42.88545, 80.57226],
		[43.02906, 80.38405],
		[43.1683, 80.81526],
		[44.11378, 80.36887],
		[44.6358, 80.38499],
		[44.73408, 80.51589],
		[44.90282, 79.87106],
		[45.3497, 81.67928],
		[45.15748, 81.94803],
		[45.13303, 82.56638],
		[45.43581, 82.64624],
		[45.5831, 82.32179],
		[47.20061, 83.03443],
		[46.97332, 83.93026],
		[46.99361, 84.67804],
		[46.8277, 84.80318],
		[47.0591, 85.52257],
		[47.26221, 85.70139],
		[47.93721, 85.53707],
		[48.39333, 85.76596],
		[48.54277, 86.59791],
		[49.1102, 86.87602],
		[49.09262, 87.34821],
		[49.17295, 87.8407],
		[48.98304, 87.89291],
		[48.88103, 87.7611],
		[48.73499, 88.05942],
		[48.56541, 87.99194],
		[48.40582, 88.51679],
		[48.21193, 88.61179],
		[47.99374, 89.08514],
		[47.88791, 90.07096],
		[46.95221, 90.9136],
		[46.57735, 91.07027],
		[46.29694, 90.92151],
		[46.01735, 91.02651],
		[45.57972, 90.68193],
		[45.25305, 90.89694],
		[45.07729, 91.56088],
		[44.95721, 93.5547],
		[44.35499, 94.71735],
		[44.29416, 95.41061],
		[44.01937, 95.34109],
		[43.99311, 95.53339],
		[43.28388, 95.87901],
		[42.73499, 96.38206],
		[42.79583, 97.1654],
		[42.57194, 99.51012],
		[42.67707, 100.8425],
		[42.50972, 101.8147],
		[42.23333, 102.0772],
		[41.88721, 103.4164],
		[41.87721, 104.5267],
		[41.67068, 104.5237],
		[41.58666, 105.0065],
		[42.46624, 107.4758],
		[42.42999, 109.3107],
		[42.64576, 110.1064],
		[43.31694, 110.9897],
		[43.69221, 111.9583],
		[44.37527, 111.4214],
		[45.04944, 111.873],
		[45.08055, 112.4272],
		[44.8461, 112.853],
		[44.74527, 113.638],
		[45.38943, 114.5453],
		[45.4586, 115.7019],
		[45.72193, 116.2104],
		[46.29583, 116.5855],
		[46.41888, 117.3755],
		[46.57069, 117.425],
		[46.53645, 117.8455],
		[46.73638, 118.3147],
		[46.59895, 119.7068],
		[46.71513, 119.9315],
		[46.90221, 119.9225],
		[47.66499, 119.125],
		[47.99475, 118.5393],
		[48.01125, 117.8046],
		[47.65741, 117.3827],
		[47.88805, 116.8747],
		[47.87819, 116.2624],
		[47.69186, 115.9231],
		[47.91749, 115.5944],
		[48.14353, 115.5491],
		[48.25249, 115.8358],
		[48.52055, 115.8111],
		[49.83047, 116.7114],
		[49.52058, 117.8747],
		[49.92263, 118.5746],
		[50.09631, 119.321],
		[50.33028, 119.36],
		[50.39027, 119.1386],
		[51.62083, 120.0641],
		[52.115, 120.7767],
		[52.34423, 120.6259],
		[52.54267, 120.7122],
		[52.58805, 120.0819],
		[52.76819, 120.0314],
		[53.26374, 120.8307],
		[53.54361, 123.6147],
		[53.18832, 124.4933],
		[53.05027, 125.62],
		[52.8752, 125.6573],
		[52.75722, 126.0968],
		[52.5761, 125.9943],
		[52.12694, 126.555],
		[51.99437, 126.4412],
		[51.38138, 126.9139],
		[51.26555, 126.8176],
		[51.31923, 126.9689],
		[51.05825, 126.9331],
		[50.74138, 127.2919],
		[50.31472, 127.334],
		[50.20856, 127.5861],
		[49.80588, 127.515],
		[49.58665, 127.838],
		[49.58443, 128.7119],
		[49.34676, 129.1118],
		[49.4158, 129.4902],
		[48.86464, 130.2246],
		[48.86041, 130.674],
		[48.60576, 130.5236],
		[48.3268, 130.824],
		[48.10839, 130.6598],
		[47.68721, 130.9922],
		[47.71027, 132.5211],
		[48.09888, 133.0827],
		[48.06888, 133.4843],
		[48.39112, 134.4153],
		[48.26713, 134.7408],
		[47.99207, 134.5576],
		[47.70027, 134.7608],
		[47.32333, 134.1825],
		[46.64017, 133.9977],
		[46.47888, 133.8472],
		[46.25363, 133.9016],
		[45.82347, 133.4761],
		[45.62458, 133.4702],
		[45.45083, 133.1491],
		[45.05694, 133.0253],
		[45.34582, 131.8684],
		[44.97388, 131.4691],
		[44.83649, 130.953],
		[44.05193, 131.298],
		[43.53624, 131.1912],
		[43.38958, 131.3104],
		[42.91645, 131.1285],
		[42.74485, 130.4327],
		[42.42186, 130.6044],
		[42.71416, 130.2468],
		[42.88794, 130.2514],
		[43.00457, 129.9046],
		[42.43582, 129.6955],
		[42.44624, 129.3493],
		[42.02736, 128.9269],
		[42.00124, 128.0566],
		[41.58284, 128.3002],
		[41.38124, 128.1529],
		[41.47249, 127.2708],
		[41.79222, 126.9047],
		[41.61176, 126.5661],
		[40.89694, 126.0118],
		[40.47037, 124.8851],
		[40.09362, 124.3736],
		[39.82752244475985, 124.189453125],//此处几个坐标是移除边界线，然后直接走海洋得到，简化计算次数
		[37.96152331396613, 123.189697265625],
		[29.688052749856798, 123.0908203125],
		[24.066528197726853, 119.20166015625],
		[19.435514339097825, 118.7841796875],
		[17.95260646769184, 110.2093505859375],
		[18.088422664636212, 108.511962890625],
		[21.51153207, 108.08177947],
		[21.54241, 107.99],
		[21.66694, 107.7831],
		[21.60526, 107.3627],
		[22.03083, 106.6933],
		[22.45682, 106.5517],
		[22.76389, 106.7875],
		[22.86694, 106.7029],
		[22.91253, 105.8771],
		[23.32416, 105.3587],
		[23.18027, 104.9075],
		[22.81805, 104.7319],
		[22.6875, 104.3747],
		[22.79812, 104.1113],
		[22.50387, 103.9687],
		[22.78287, 103.6538],
		[22.58436, 103.5224],
		[22.79451, 103.3337],
		[22.43652, 103.0304],
		[22.77187, 102.4744],
		[22.39629, 102.1407],
		[22.49777, 101.7415],
		[22.20916, 101.5744],
		[21.83444, 101.7653],
		[21.14451, 101.786],
		[21.17687, 101.2919],
		[21.57264, 101.1482],
		[21.76903, 101.099],
		[21.47694, 100.6397],
		[21.43546, 100.2057],
		[21.72555, 99.97763],
		[22.05018, 99.95741],
		[22.15592, 99.16785],
		[22.93659, 99.56484],
		[23.08204, 99.5113],
		[23.18916, 98.92747],
		[23.97076, 98.67991],
		[24.16007, 98.89073],
		[23.92999, 97.54762],
		[24.26055, 97.7593],
		[24.47666, 97.54305],
		[24.73992, 97.55255],
		[25.61527, 98.19109],
		[25.56944, 98.36137],
		[25.85597, 98.7104],
		[26.12527, 98.56944],
		[26.18472, 98.73109],
		[26.79166, 98.77777],
		[27.52972, 98.69699],
		[27.6725, 98.45888],
		[27.54014, 98.31992],
		[28.14889, 98.14499],
		[28.54652, 97.55887],
		[28.22277, 97.34888],
		[28.46749, 96.65387],
		[28.35111, 96.40193],
		[28.525, 96.34027],
		[28.79569, 96.61373],
		[29.05666, 96.47083],
		[28.90138, 96.17532],
		[29.05972, 96.14888],
		[29.25757, 96.39172],
		[29.46444, 96.08315],
		[29.03527, 95.38777],
		[29.33346, 94.64751],
		[29.07348, 94.23456],
		[28.6692, 93.96172],
		[28.61876, 93.35194],
		[28.3193, 93.22205],
		[28.1419, 92.71044],
		[27.86194, 92.54498],
		[27.76472, 91.65776],
		[27.945, 91.66277],
		[28.08111, 91.30138],
		[27.96999, 91.08693],
		[28.07958, 90.3765],
		[28.24257, 90.38898],
		[28.32369, 89.99819],
		[28.05777, 89.48749],
		[27.32083, 88.91693]
	];

	/**
	 * @var array 香港坐标范围
	 */
	private static $hong_kong_map = [
		[22.249999892647594, 114.50441355319435],
		[22.368126048048683, 114.50443993961295],
		[22.466006243124475, 114.45971254142662],
		[22.542254757750978, 114.4599611599683],
		[22.55932090471159, 114.43884768753253],
		[22.565206463021347, 114.344184162758],
		[22.562671018902346, 114.28081502180774],
		[22.55043259777784, 114.2477793560842],
		[22.541094108513626, 114.23236040195029],
		[22.551982474025873, 114.22396081221211],
		[22.55453972269849, 114.20533830058012],
		[22.55110903642457, 114.1858636778768],
		[22.55693640884497, 114.18190816970951],
		[22.556282253648927, 114.16886549165515],
		[22.559054819129546, 114.16620633895373],
		[22.552294621440392, 114.16167796133432],
		[22.55204329573786, 114.15710142281712],
		[22.538902216990667, 114.15341156277034],
		[22.539153556037714, 114.13578028510814],
		[22.537293224840262, 114.13400173187256],
		[22.536817569098282, 114.13061141967773],
		[22.528929372495444, 114.12095546722412],
		[22.52670949724544, 114.11662101745605],
		[22.53031677641036, 114.11335945129395],
		[22.531307770674214, 114.10297393798828],
		[22.53396360023646, 114.09808158874512],
		[22.53343707193792, 114.09372327592442],
		[22.529642896249428, 114.09070014953613],
		[22.52705622228592, 114.08348778048558],
		[22.51556035023105, 114.07731556551114],
		[22.513722117271967, 114.06898855529884],
		[22.50994035876407, 114.0640926361084],
		[22.502447107410138, 114.06181812286377],
		[22.499512110074636, 114.05704842171406],
		[22.505012706928436, 114.02876351373768],
		[22.497720366785614, 114.01753996106691],
		[22.50764657336277, 114.00005749188864],
		[22.469371790345302, 113.952660425717],
		[22.42579717853363, 113.87398492346281],
		[22.33031555294684, 113.87396523778321],
		[22.27015932886428, 113.85229493623311],
		[22.26479247430387, 113.84392493006567],
		[22.214179718613675, 113.82209377441288],
		[22.18096131238036, 113.83732167052551],
		[22.139561111546026, 113.90135982635742],
		[22.133772057053257, 113.92718432055024],
		[22.14553272502743, 113.94436561774847],
		[22.14569569642202, 114.24078049550716],
		[22.135940549792845, 114.25929643465665],
		[22.145716826576773, 114.2887681363611],
		[22.145698263611518, 114.50439118472904],
		[22.249999892647594, 114.50441355319435]
	];

	/**
	 * @var array 澳门边界 坐标
	 */
	private static $macao_map = [
		[22.20040420937448, 113.576824210468],
		[22.210899257214723, 113.56521182956781],
		[22.214325537708863, 113.54938073074514],
		[22.213549910287544, 113.54297161102295],
		[22.209854951267875, 113.53400230407715],
		[22.20602083179696, 113.53479623794556],
		[22.198610552801735, 113.53803634643555],
		[22.184469689186336, 113.53329828238885],
		[22.178363784618646, 113.5328029478798],
		[22.154100922132123, 113.54207038879395],
		[22.141370325851674, 113.5540582813416],
		[22.109866179779, 113.55374832388527],
		[22.102301049950423, 113.55989800975762],
		[22.102436011325323, 113.57091494192457],
		[22.10839000904641, 113.58756638865023],
		[22.118335841443894, 113.6014786594061],
		[22.130923195366428, 113.60988163834484],
		[22.142441290591666, 113.6087190335273],
		[22.178629428116107, 113.5930442414218],
		[22.20040420937448, 113.576824210468]
	];

	/**
	 * @var array 台湾边界坐标
	 */
	private static $taiwan_map = [
		[25.45319497952487, 121.431884765625],
		[24.14174098050432, 120.069580078125],
		[23.61432859499168, 119.366455078125],
		[23.089838367476705, 119.3389892578125],
		[22.54807431541815, 119.827880859375],
		[21.662533492414674, 120.5255126953125],
		[21.53995662308542, 121.3275146484375],
		[22.319589442833912, 122.0635986328125],
		[23.775291236451384, 121.9537353515625],
		[24.617057340809524, 122.200927734375],
		[25.418470119273117, 122.1185302734375],
		[25.45319497952487, 121.431884765625]
	];

	/**
	 * 判断GPS坐标是否在多边形中
	 * @param array  $list [维度,经度] 的形式，取0,1键值
	 * @param float $lat  维度
	 * @param float $lng  经度
	 * @return bool
	 */
	public static function IsInsidePolygon($list, $lat, $lng): bool
	{
		$inside = false;
		$prePoint = $list[0];
		$length = count($list);
		for($i = 1; $i < $length; $i++) {
			$nextPoint = $list[$i];
			if($lng > min($prePoint[1], $nextPoint[1])
				&& $lng <= max($prePoint[1], $nextPoint[1])
				&& $lat <= max($prePoint[0], $nextPoint[0])
				&& $prePoint[1] != $nextPoint[1]
			) {
				$xinters = ($lng - $prePoint[1]) * ($nextPoint[0] - $prePoint[0]) / ($nextPoint[1] - $prePoint[1]) + $prePoint[0];
				if($prePoint[0] == $nextPoint[0] || $lat <= $xinters)
					$inside ^= true;
			}
			$prePoint = $nextPoint;
		}
		return (bool)$inside;
	}

	/**
	 * 是否在中国
	 * @param float $lat 维度
	 * @param float $lng 经度
	 * @return bool
	 */
	public static function inChina(float $lat, float $lng): bool
	{
		return self::IsInsidePolygon(self::$taiwan_map, $lat, $lng) ||
		self::IsInsidePolygon(self::$main_land_map, $lat, $lng);
	}

	/**
	 * 是否在香港
	 * @param float $lat 维度
	 * @param float $lng 经度
	 * @return bool
	 */
	public static function inHongKong(float $lat, float $lng): bool
	{
		return self::IsInsidePolygon(self::$hong_kong_map, $lat, $lng);
	}

	/**
	 * 是否在澳门
	 * @param float $lat 维度
	 * @param float $lng 经度
	 * @return bool
	 */
	public static function inMacao(float $lat, float $lng): bool
	{
		return self::IsInsidePolygon(self::$macao_map, $lat, $lng);
	}

	/**
	 * 是否在中国大陆，非香港澳门
	 * @param float $lat 维度
	 * @param float $lng 经度
	 * @return bool
	 */
	public static function inChinaMainLand(float $lat, float $lng): bool
	{
		return self::IsInsidePolygon(self::$main_land_map, $lat, $lng) &&
		!self::IsInsidePolygon(self::$hong_kong_map, $lat, $lng) &&
		!self::IsInsidePolygon(self::$macao_map, $lat, $lng);
	}

	/**
	 * 是否在台湾
	 * @param float $lat 维度
	 * @param float $lng 经度
	 * @return bool
	 */
	public static function inTaiwan(float $lat, float $lng): bool
	{
		return self::IsInsidePolygon(self::$taiwan_map, $lat, $lng);
	}

	/**
	 * @return array
	 */
	public static function getMainLandMap(): array
	{
		return self::$main_land_map;
	}

	/**
	 * @return array
	 */
	public static function getHongKongMap(): array
	{
		return self::$hong_kong_map;
	}

	/**
	 * @return array
	 */
	public static function getMacaoMap(): array
	{
		return self::$macao_map;
	}

	/**
	 * @return array
	 */
	public static function getTaiwanMap(): array
	{
		return self::$taiwan_map;
	}

}